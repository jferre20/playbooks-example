---
- hosts: localhost
  gather_facts: false
  tasks:
    - name: Recursively find /tmp files
      ansible.builtin.find:
        paths: /tmp/teste
      register: files_found
    
    - name: Copy files
      ansible.builtin.copy:
        src: "{{ item.path }}"
        dest: /tmp/new-files/
      notify: Teste 
      loop: "{{ files_found.files }}"
    
    - set_fact:
        files: "{{ files_found.files | map(attribute='path') }}"

    - set_fact:
        list_files: "{{ list_files | default([]) + [ item.split('/')[3] ] }}"
      loop: "{{ files }}"

    - debug:
        msg: "{{ list_files }}"

  handlers:
    - name: Teste
      ansible.builtin.shell: "echo 'OK'"
